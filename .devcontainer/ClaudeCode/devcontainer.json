// See https://containers.dev/implementors/json_reference/ for configuration reference
{
	"name": "Claude Code",
	"build": {
		"dockerfile": "Dockerfile"
	},
	"remoteUser": "node",

	// Mount Docker socket from WSL2 host
	"mounts": [
		"source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
	],

	// Add user to docker group for non-root docker access and connect to PeerTube network
	"runArgs": ["--group-add=docker", "--network=local_default"],
	
	// Run commands after each container start
	"postStartCommand": "sudo chgrp docker /var/run/docker.sock && sudo chmod g+rw /var/run/docker.sock && grep -q 'peertube.localhost' /etc/hosts || echo '172.18.0.5 peertube.localhost' | sudo tee -a /etc/hosts && bash -c 'source .devcontainer/ClaudeCode/.env && peertube-cli auth add -u \"http://peertube.localhost:9000\" -U \"root\" --password \"$PEERTUBE_PASSWORD\" 2>/dev/null || true'"
}
